on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions: write-all

jobs:
  build_container:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        # cd tests/docker/dockerfiles/
        # ls *docker | sed -e 's/.docker//' | tr '\n' ','
        # remove: debian-bootstrap,debian-toolchain
        container: [alpine,centos9,debian-all-test-cross,debian-amd64-cross,debian-arm64-cross,debian-armhf-cross,debian,debian-hexagon-cross,debian-i686-cross,debian-legacy-test-cross,debian-loongarch-cross,debian-mips64el-cross,debian-mipsel-cross,debian-ppc64el-cross,debian-riscv64-cross,debian-s390x-cross,debian-tricore-cross,debian-xtensa-cross,fedora,fedora-rust-nightly,fedora-win64-cross,opensuse-leap,python,ubuntu2204]
    steps:
      - run: git clone https://gitlab.com/qemu-project/qemu
      - run: make -C qemu docker-image-${{matrix.container}} RUNC=podman V=1
      - run: podman tag qemu/${{matrix.container}} docker.io/pbolinaro/qemu-ci:${{matrix.container}}
      - run: podman login -u pbolinaro -p ${{secrets.DOCKERHUB_PASSWORD}}
      - run: podman push docker.io/pbolinaro/qemu-ci:${{matrix.container}}

  keepalive-job:
    name: Keepalive Workflow
    if: ${{ always() }}
    needs: build_container
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - uses: gautamkrishnar/keepalive-workflow@v2
        with:
          use_api: false
